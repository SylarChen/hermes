<?xml version="1.0" encoding="UTF-8"?>
<entities do-package="com.ctrip.hermes.broker.dal.hermes" gen="true">
	<entity name="message-priority">
		<var name="topic" value-type="String" />
		<var name="partition" value-type="int" />
		<var name="priority" value-type="int" />
		<var name="start-id" value-type="long" />
		<var name="batch-size" value-type="int" />

		<query-defs>
			<query name="insert" type="INSERT" batch='true'>
				<statement><![CDATA[INSERT INTO <TABLE/>(<FIELDS/>)
        		VALUES(<VALUES/>)]]>
				</statement>
			</query>
			<query name="findIdAfter" type="SELECT" multiple="true">
				<param name="topic" />
				<param name="partition" />
				<param name="priority" />
				<param name="start-id" />
				<param name="batch-size" />
				<statement><![CDATA[SELECT <FIELDS/>
        		FROM <TABLE/>
        		WHERE <FIELD name='id'/> > ${start-id}
        		LIMIT ${batch-size}]]>
				</statement>
			</query>
			<query name="top" type="SELECT" multiple="true">
				<param name="topic" />
				<param name="partition" />
				<param name="priority" />
				<statement><![CDATA[SELECT <FIELDS/>
        		FROM <TABLE/>
        		ORDER BY <FIELD name='id'/> DESC
        		LIMIT 1]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="offset-message">
		<var name="partition" value-type="int" />
		<var name="topic" value-type="String" />
		<updatesets>
			<updateset name="OFFSET">
				<member name='offset' />
			</updateset>
		</updatesets>
		<query-defs>
			<query name="find" type="SELECT" multiple="true">
				<param name="topic" />
				<param name="partition" />
				<param name="priority" />
				<param name="group-id" />

				<statement><![CDATA[SELECT <FIELDS/>
        		FROM <TABLE/>
        		WHERE <FIELD name='priority'/> = ${priority}
        		AND <FIELD name='group-id'/> = ${group-id}]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="resend-group-id">
		<var name="topic" value-type="String" />
		<var name="partition" value-type="int" />
		<var name="group-id" value-type="int" />
		<var name="batch-size" value-type="int" />

		<query-defs>
			<query name="insert" type="INSERT" batch='true'>
				<statement><![CDATA[INSERT INTO <TABLE/>(<FIELDS/>)
        		VALUES(<VALUES/>)]]>
				</statement>
			</query>
			<query name="find" type="SELECT" multiple="true">
				<param name="topic" />
				<param name="partition" />
				<param name="group-id" />
				<param name="schedule-date" />
				<param name="batch-size" />
				<statement><![CDATA[SELECT <FIELDS/>
        		FROM <TABLE/>
        		WHERE <FIELD name='schedule-date'/> <= ${schedule-date}
        		ORDER BY <FIELD name='schedule-date'/> ASC
        		LIMIT ${batch-size}]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="offset-resend">
		<var name="topic" value-type="String" />
		<var name="partition" value-type="int" />

		<updatesets>
			<updateset name="OFFSET">
				<member name='last-schedule-date' />
				<member name='last-id' />
			</updateset>
		</updatesets>

		<query-defs>
			<query name="top" type="SELECT" multiple="true">
				<param name="topic" />
				<param name="partition" />
				<param name="group-id" />

				<statement><![CDATA[SELECT <FIELDS/>
        		FROM <TABLE/>
        		WHERE <FIELD name='group-id'/> = ${group-id}
        		]]>
				</statement>
			</query>
		</query-defs>
	</entity>

	<entity name="dead-letter">
		<var name="topic" value-type="String" />
		<var name="partition" value-type="int" />
	</entity>


</entities>

